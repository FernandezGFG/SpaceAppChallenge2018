var map2D;
var sat;

// Malargüe 35°28′28″S 69°35′07″O
var lat = -33.53;
var lon = -68.5;

var TOKEN = "pk.eyJ1IjoiZmVybmFuZGV6Z2ZnIiwiYSI6ImNqbmhtMndpbjBmZHEzdXF6YmU4aHR2cHkifQ.qeUjbXz-KdhtFf-1G_KRiQ";

var SIZE_IMGX = 1024;
var SIZE_IMGY = 512;
var MAP_ZOOM = 1;

var MAP_TYPE = "dark-v9"; 

function preload(){    
    map2D = loadImage("https://api.mapbox.com/styles/v1/mapbox/" + MAP_TYPE + "/static/0,0," + MAP_ZOOM + ",0,0/" + SIZE_IMGX + "x" + SIZE_IMGY + "?access_token=" + TOKEN);
}

var map1;
var map2;

var C_LAT = 0;
var C_LON = 0;

function gotData(data){
    println(data);
}

function setup() {
    createCanvas(SIZE_IMGX, SIZE_IMGY);
    translate(width / 2, height / 2);
    imageMode(CENTER);
    var Cx = convX(C_LON);
    var Cy = convY(C_LAT);
    var x = 0;
    var y = 0;    map1 = new Map(x, y);
    map2 = new Map(x-SIZE_IMGX, y);
    map1.display();
    map2.display();
    x = convX(lon) - Cx;
    y = convY(lat) - Cy;
    fill(255, 0, 255, 200);
    ellipse(x, y, 20, 20);
}

function convX(lon){
    lon = radians(lon);
    var n1 = (256 / PI) * pow(2, MAP_ZOOM);
    var n2 = (lon + PI);
    return n1*n2;
}

function convY(lat){
    lat = radians(lat);
    var n1 = (256 / PI) * pow(2, MAP_ZOOM);
    var n2 = tan(PI / 4 + lat / 2);
    var n3 = PI - log(n2);
    return n1*n3;
}

function Map(x, y){
    this.x = x;
    this.y = y;
    this.display = function(){
	image(map2D, this.x, this.y);
    };
}

function draw() {
    //background(0);
    //map1.display();
    //map2.display();
}

function mouseDragged(){
    map1.x = mouseX;
    map2.x = mouseX - SIZE_IMGX;
    if (map1.x > 0){
	map2.x = map1.x - SIZE_IMGX;
    }
    if (map2.x > 0){
	map1.x = map2.x - SIZE_IMGX;
    }
}
